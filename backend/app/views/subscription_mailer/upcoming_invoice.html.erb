<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type' />
  </head>
  <body>
    <h1>Upcoming Invoice - Payment Due Soon</h1>
    
    <p>Dear <%= @customer.name %>,</p>
    
    <p>This is a friendly reminder that your next invoice is due soon.</p>
    
    <h2>Invoice Preview</h2>
    <ul>
      <li><strong>Invoice Number:</strong> <%= @invoice.invoice_number %></li>
      <li><strong>Subscription:</strong> <%= @subscription.reference_number %></li>
      <li><strong>Plan:</strong> <%= @subscription.plan_name %></li>
      <li><strong>Amount:</strong> KES <%= @invoice.amount %></li>
      <li><strong>Due Date:</strong> <%= @invoice.due_date.strftime('%B %d, %Y') %></li>
      <li><strong>Days Until Due:</strong> <%= (@invoice.due_date - Date.current).to_i %> days</li>
    </ul>
    
    <h2>Line Items</h2>
    <% if @invoice.line_items.present? %>
      <table style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background-color: #f5f5f5;">
            <th style="padding: 8px; text-align: left; border: 1px solid #ddd;">Description</th>
            <th style="padding: 8px; text-align: right; border: 1px solid #ddd;">Quantity</th>
            <th style="padding: 8px; text-align: right; border: 1px solid #ddd;">Unit Price</th>
            <th style="padding: 8px; text-align: right; border: 1px solid #ddd;">Amount</th>
          </tr>
        </thead>
        <tbody>
          <% @invoice.line_items.each do |item| %>
            <tr>
              <td style="padding: 8px; border: 1px solid #ddd;"><%= item['description'] %></td>
              <td style="padding: 8px; text-align: right; border: 1px solid #ddd;"><%= item['quantity'] %></td>
              <td style="padding: 8px; text-align: right; border: 1px solid #ddd;">KES <%= item['unit_price'] %></td>
              <td style="padding: 8px; text-align: right; border: 1px solid #ddd;">KES <%= item['amount'] %></td>
            </tr>
          <% end %>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" style="padding: 8px; text-align: right; border: 1px solid #ddd;"><strong>Total:</strong></td>
            <td style="padding: 8px; text-align: right; border: 1px solid #ddd;"><strong>KES <%= @invoice.amount %></strong></td>
          </tr>
        </tfoot>
      </table>
    <% else %>
      <p><%= @subscription.plan_name %> - KES <%= @invoice.amount %></p>
    <% end %>
    
    <p><strong>Payment is due on <%= @invoice.due_date.strftime('%B %d, %Y') %>.</strong></p>
    
    <% if @subscription.preferred_payment_method == 'ratiba' %>
      <p>Your payment will be automatically processed via your standing order (Ratiba) on the due date.</p>
    <% else %>
      <p>Please ensure your payment method is up to date. You can update your payment method or make a payment through your dashboard.</p>
    <% end %>
    
    <p>If you have any questions or need assistance, please contact our support team.</p>
    
    <p>Thank you for your continued business!</p>
  </body>
</html>

